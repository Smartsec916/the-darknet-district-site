
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Byte Bazaar — Add-Men Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{
      --frame-w:960px;
      --ink:#e6ffd5;
      --ink-dim:#b7d8b0;
      --edge:#284235;
      --crt-green:#b7ff44;
      --crt-fill-1:#112414;
      --crt-fill-2:#0b1a0e;
      --accent:#8ad0ff;
    }
    html,body{margin:0;height:100%;background:#050b14;color:var(--ink);font-family:ui-monospace,Menlo,Consolas,monospace;overflow:hidden}
    .frame{position:relative;width:100%;max-width:var(--frame-w);margin:0 auto;aspect-ratio:4/3;border:2px solid #1a2830;border-radius:14px;background:#000;box-shadow:0 18px 80px rgba(0,0,0,.45) inset, 0 16px 60px rgba(16,28,48,.35)}
    .keeper{position:absolute;inset:0;object-fit:cover;width:100%;height:100%;image-rendering:pixelated}

    /* CRT panel */
    .crt{
      position:absolute;
      padding:14px 16px;
      border-radius:18px;
      color:var(--ink);
      border:2px solid color-mix(in oklab, var(--crt-green) 55%, #1a3b18);
      background:linear-gradient(180deg, color-mix(in oklab, var(--crt-fill-1) 96%, #000), color-mix(in oklab, var(--crt-fill-2) 98%, #000));
      box-shadow:0 0 0 2px rgba(183,255,68,.06) inset, 0 18px 26px rgba(0,0,0,.45) inset, 0 0 18px rgba(183,255,68,.08);
      text-shadow:0 0 2px rgba(183,255,68,.3), 0 0 8px rgba(183,255,68,.12);
      overflow:hidden;
    }
    .crt::before{
      content:"";position:absolute;inset:0;pointer-events:none;
      background:
        repeating-linear-gradient(0deg, rgba(183,255,68,.12) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(90deg, rgba(183,255,68,.055) 0 1px, transparent 1px 5px);
      mix-blend-mode:screen;opacity:.32;
    }

    /* labels & panels */
    .badge{position:absolute;left:3%;top:4%;padding:6px 9px;border-radius:12px;background:rgba(7,14,10,.78);border:1px solid var(--edge)}
    .badge .lbl{color:var(--accent)}

    .bubble{right:4%;top:8%;max-width:36%}
    .bubble h3{margin:0 0 6px 0;color:#99ff6a;font-size:12px;letter-spacing:.5px}
    .bubble .text{white-space:pre-wrap;line-height:1.4em;min-height:2.6em}
    .bubble .cursor{display:inline-block;width:7px;height:1em;background:#7cff57;margin-left:2px;animation:blink .9s steps(1) infinite;vertical-align:-2px}
    .bubble:after{content:"";position:absolute;right:26px;bottom:-16px;border:10px solid transparent;border-top-color:color-mix(in oklab, var(--crt-green) 55%, #1a3b18)}
    @keyframes blink{50%{opacity:0}}

    .inv{left:3%;top:18%;width:22%;min-height:120px}
    .inv h4{margin:0 0 8px 0;color:#a7ff89;font-size:12px;letter-spacing:.5px}
    .slot{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px;border-radius:12px;margin:6px 0;border:1px dashed rgba(183,255,68,.35);background:rgba(10,22,12,.35);color:var(--ink)}
    .tag{font-size:10px;color:#c1ffae}

    /* Bottom rows */
    .items{position:absolute;left:3%;right:22%;bottom:4%;display:flex;gap:12px;flex-wrap:wrap}
    .card{position:relative;flex:0 1 260px}
    .card h5{margin:0 0 6px 0;font-size:13px;letter-spacing:.3px;color:#cfff9f}
    .card p{margin:0 0 10px 0;color:var(--ink-dim);font-size:12px}
    .price{color:#9cff7e}
    .buy{cursor:pointer;border-radius:10px;border:1px solid #2f3c56;background:#0f1522;color:#d9f7ff;padding:8px 10px}
    .buy[disabled]{opacity:.5;cursor:not-allowed}

    /* Continue button location (bottom-right) */
    .continue{position:absolute;right:3%;bottom:4%}
    .continue .card{cursor:pointer;user-select:none}
    .continue .card:hover{box-shadow:0 0 0 2px rgba(183,255,68,.14)}
  </style>
</head>
<body>
  <div class="frame">
    <img id="keeper" class="keeper" src="assets/shop_addmen.png" alt="Add-Men">

    <div class="badge">Balance → <span class="lbl" id="balLbl">BTC:0</span></div>

    <div class="crt bubble">
      <h3>【Add-Men】</h3>
      <div class="text" id="bubble">Welcome back, Netrunner. New stock just came in.<span class="cursor"></span></div>
    </div>

    <div class="crt inv">
      <h4>Inventory</h4>
      <div class="slot" id="emptySlot"><span>Nothing installed yet.</span></div>
      <div class="list" id="invList"></div>
    </div>

    <div class="items" id="items"></div>

    <div class="continue">
      <div class="crt card" id="continueCard">
        <h5>Continue</h5>
        <p>Head back out. Unspent BTC carries forward.</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { getRunN, setRunN, getRunO, setRunO, goTo } from './engine.js';

    let btc = getRunN('playerBTC', 0);
    let upgrades = getRunO('playerUpgrades', {});

    const items = [
      { id: 'mobileEMP', name: 'Mobile EMP', desc: '+2 charges. Trigger EMP anywhere (E).', price: 5, key: 'mobileEMP' }
    ];

    function updateUI(){
      document.getElementById('balLbl').textContent = `BTC:${btc}`;
      const itemsDiv = document.getElementById('items');
      itemsDiv.innerHTML = items.map(item => {
        const owned = upgrades[item.key] === true;
        const canBuy = btc >= item.price && !owned;
        return `
          <div class="crt card">
            <h5>${item.name}</h5>
            <p>${item.desc}</p>
            <button class="buy" ${canBuy ? '' : 'disabled'} data-key="${item.key}" data-price="${item.price}">
              Buy — <span class="price">${item.price} BTC</span>
            </button>
          </div>
        `;
      }).join('');

      // Add click listeners to buy buttons
      itemsDiv.querySelectorAll('.buy').forEach(btn => {
        btn.onclick = () => {
          const key = btn.dataset.key;
          const price = parseInt(btn.dataset.price);
          buyItem(key, price);
        };
      });

      const invList = document.getElementById('invList');
      const owned = Object.keys(upgrades).filter(k => upgrades[k] === true);
      if(owned.length > 0){
        document.getElementById('emptySlot').style.display = 'none';
        invList.innerHTML = owned.map(key => {
          const item = items.find(i => i.key === key);
          return `<div class="slot"><span>${item ? item.name : key}</span><span class="tag">ACTIVE</span></div>`;
        }).join('');
      }
    }

    function buyItem(key, price){
      if(btc >= price && !upgrades[key]){
        btc -= price;
        if(key === 'mobileEMP') upgrades.mobileEMPCharges = 2;
        upgrades[key] = true;
        setRunN('playerBTC', btc);
        setRunO('playerUpgrades', upgrades);
        updateUI();
      }
    }

    document.getElementById('continueCard').onclick = () => goTo('./level2.html');

    updateUI();
  </script>
</body>
</html>
